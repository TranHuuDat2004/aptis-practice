<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reading Practice</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;700&display=swap" rel="stylesheet">
<link rel="icon" href="img/favicon.png" type="image/x-icon">
</head>

<body>
    <!-- HEADER PLACEHOLDER -->
    <header id="header-placeholder"></header>
    <div class="content-pusher" id="content-pusher"> <!-- TH√äM D√íNG N√ÄY -->
        <div class="container">

                <h1 style="text-align: center;" id="page-title">Reading Practice</h1>
                <p style="text-align: center;" id="page-description">Luy·ªán t·∫≠p s·∫Øp x·∫øp c√¢u</p>

            <!-- H·ªòP GI·∫¢I TH√çCH M·ªöI -->
            <div class="explanation-box">
                <h3>üí° Gi·∫£i th√≠ch ph∆∞∆°ng ph√°p h·ªçc</h3>
                <p><strong>C√¢u chuy·ªán Logic (Th·∫≠t):</strong> L√† c√¢u chuy·ªán ƒë∆∞·ª£c x√¢y d·ª±ng d·ª±a tr√™n tr√¨nh t·ª± h·ª£p l√Ω c·ªßa
                    b√†i
                    ƒë·ªçc g·ªëc trong ƒë·ªÅ thi. Ph∆∞∆°ng ph√°p n√†y gi√∫p b·∫°n hi·ªÉu v√† ghi nh·ªõ n·ªôi dung m·ªôt c√°ch logic.</p>
                <p><strong>C√¢u chuy·ªán B·ªãa (Ghi nh·ªõ):</strong> L√† m·ªôt c√¢u chuy·ªán s√°ng t·∫°o, ƒë√¥i khi v√¥ l√Ω, kh√¥ng li√™n quan
                    ƒë·∫øn
                    b√†i ƒë·ªçc.
                    <br>
                    M·ª•c ƒë√≠ch duy nh·∫•t l√† ƒë·ªÉ "m√£ h√≥a" th·ª© t·ª± ƒë√°p √°n (key) kh√≥ nh·ªõ th√†nh m·ªôt c√¢u chuy·ªán ƒë·ªôc ƒë√°o,
                    gi√∫p
                    b·∫°n h·ªçc thu·ªôc m·ªôt c√°ch hi·ªáu qu·∫£.</p>
            </div>
            <main id="quiz-container">
                <!-- C√°c c√¢u h·ªèi s·∫Ω ƒë∆∞·ª£c t·ª± ƒë·ªông ch√®n v√†o ƒë√¢y -->
            </main>
        </div>

        <!-- SCRIPTS -->

        <script src="js/data-reading.js"></script>
        <!-- FOOTER PLACEHOLDER -->
        <footer id="footer-placeholder"></footer>
    </div>
    <!-- SCRIPT CH√çNH -->
    <script src="js/main.js"></script>
    <!-- Th√™m th∆∞ vi·ªán SortableJS -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const quizContainer = document.getElementById('quiz-container');
            const pageTitle = document.getElementById('page-title');
            const pageDescription = document.getElementById('page-description');

            const urlParams = new URLSearchParams(window.location.search);
            const partNumber = 3;

            if (!partNumber || !readingData['part' + partNumber]) {
                quizContainer.innerHTML = `<p class="error">Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu cho ph·∫ßn n√†y.</p>`;
                pageTitle.textContent = "L·ªói"; return;
            }

            pageTitle.textContent = `Reading - Part ${partNumber}`;
            pageDescription.textContent = `Luy·ªán t·∫≠p c√°c c√¢u h·ªèi c·ªßa Part ${partNumber}`;
            const questions = readingData['part' + partNumber];

            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            questions.forEach((item, index) => {
                const originalFragmentsWithIndex = item.fragments.map((frag, i) => ({ text: frag, originalIndex: i + 1 }));
                const shuffledFragments = shuffleArray([...originalFragmentsWithIndex]);
                const card = document.createElement('div');
                card.className = 'quiz-card';
                card.dataset.key = item.key;

                let listItems = '';
                shuffledFragments.forEach(frag => {
                    listItems += `<li data-original-index="${frag.originalIndex}">
                                <span class="original-number">(${frag.originalIndex})</span> ${frag.text}
                              </li>`;
                });

                card.innerHTML = `
                <div class="card-header">
                    <h2>ƒê·ªÅ b√†i ${index + 1}: ${item.title}</h2>
                    <span class="tag ${item.type.includes('Logic') ? 'tag-logic' : 'tag-bia'}">${item.type}</span>
                </div>
                <p class="instructions">K√©o v√† th·∫£ ƒë·ªÉ s·∫Øp x·∫øp c√°c c√¢u theo ƒë√∫ng th·ª© t·ª±.</p>
                <ul class="sentence-list sortable-list">${listItems}</ul>
                <div class="feedback-message"></div>
                <div class="card-actions">
                    <button class="action-btn check-answer-btn">Ki·ªÉm tra ƒë√°p √°n</button>
                    <button class="action-btn show-story-btn">Xem ƒë√°p √°n & c√¢u chuy·ªán</button>
                </div>
                <div class="answer-section" style="display: none;">
                    <h4>ƒê√°p √°n</h4>
                    <p><strong>Key ƒë√∫ng:</strong> ${item.key}</p>
                    <p><strong>C√¢u chuy·ªán g·ª£i nh·ªõ:</strong> ${item.story}</p>
                </div>
            `;
                quizContainer.appendChild(card);

                // --- K√çCH HO·∫†T K√âO TH·∫¢ B·∫∞NG SORTABLEJS ---
                const sortableList = card.querySelector('.sortable-list');
                new Sortable(sortableList, {
                    animation: 150, // Hi·ªáu ·ª©ng m∆∞·ª£t m√† khi s·∫Øp x·∫øp
                    ghostClass: 'sortable-ghost' // Class cho 'b√≥ng' c·ªßa m·ª•c ƒëang k√©o
                });
            });

            quizContainer.addEventListener('click', function (e) {
                if (e.target.classList.contains('check-answer-btn')) {
                    const card = e.target.closest('.quiz-card');
                    const list = card.querySelector('.sortable-list');
                    const feedbackDiv = card.querySelector('.feedback-message');
                    const correctKey = card.dataset.key;
                    const currentOrder = Array.from(list.querySelectorAll('li')).map(li => li.dataset.originalIndex).join('-');
                    card.classList.remove('correct', 'incorrect');
                    if (currentOrder === correctKey) {
                        card.classList.add('correct');
                        feedbackDiv.innerHTML = 'üéâ Ch√≠nh x√°c! R·∫•t t·ªët!';
                    } else {
                        card.classList.add('incorrect');
                        feedbackDiv.innerHTML = '‚ùå Sai r·ªìi! H√£y th·ª≠ s·∫Øp x·∫øp l·∫°i.';
                    }
                }
                if (e.target.classList.contains('show-story-btn')) {
                    const answerSection = e.target.closest('.card-actions').nextElementSibling;
                    const isVisible = answerSection.style.display === 'block';
                    answerSection.style.display = isVisible ? 'none' : 'block';
                }
            });
        });
    </script>
</body>

</html>