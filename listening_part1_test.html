<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listening - Part 1</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="icon" href="img/favicon.png" type="image/x-icon">
</head>
<style>
    /* === CSS CHO TRANG LISTENING PART 1 === */

    .listening-question .question-title {
        font-weight: 500;
        margin-bottom: 20px;
    }

    .options-container {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .radio-label {
        display: block;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
    }

    .radio-label:hover {
        background-color: #f8f9fa;
        border-color: #007bff;
    }

    .radio-label input[type="radio"] {
        margin-right: 10px;
    }

    /* Style cho tr·∫°ng th√°i ƒê√∫ng/Sai */
    .quiz-card.correct {
        border-left: 5px solid #28a745;
        background-color: #e6ffed;
    }

    .quiz-card.incorrect {
        border-left: 5px solid #dc3545;
        background-color: #ffe6e6;
    }

    .feedback-answer {
        margin-top: 15px;
        font-weight: 500;
    }

    .quiz-card.correct .feedback-answer {
        color: #28a745;
    }

    .quiz-card.incorrect .feedback-answer {
        color: #dc3545;
    }

    /* Style cho ph√¢n trang */
    .pagination-controls {
        text-align: center;
        margin: 30px 0;
    }

    .pagination-controls button {
        background-color: #fff;
        border: 1px solid #ccc;
        color: #333;
        padding: 10px 15px;
        margin: 0 5px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1em;
    }

    .pagination-controls button.active {
        background-color: #007bff;
        color: #fff;
        border-color: #007bff;
    }

    .audio-player {
    width: 100%;
    margin-bottom: 20px;
    
    /* === ƒê√ÇY L√Ä D√íNG ƒê·ªÇ ·∫®N AUDIO === */
    display: none; 
}
</style>

<body>
    <header id="header-placeholder"></header>
    <div class="content-pusher">
        <div class="container">
            <div class="page-intro">
                <h1>Listening - Part 1</h1>
                <p>Nghe ƒëo·∫°n h·ªôi tho·∫°i ng·∫Øn v√† ch·ªçn c√¢u tr·∫£ l·ªùi ƒë√∫ng.</p>
            </div>
            <div class="explanation-box">
                <h3>üí° Ph∆∞∆°ng ph√°p h·ªçc Part 1</h3>
                <p>D·∫°ng b√†i n√†y ki·ªÉm tra kh·∫£ nƒÉng nghe hi·ªÉu th√¥ng tin chi ti·∫øt trong c√°c ƒëo·∫°n h·ªôi tho·∫°i ng·∫Øn. H√£y t·∫≠p
                    trung v√†o c√°c t·ª´ kh√≥a trong c√¢u h·ªèi (v√≠ d·ª•: "what time", "where", "who") ƒë·ªÉ x√°c ƒë·ªãnh th√¥ng tin c·∫ßn
                    nghe.</p>
            </div>
            <main id="quiz-container">
                <!-- N·ªôi dung c√¢u h·ªèi tr·∫Øc nghi·ªám s·∫Ω ƒë∆∞·ª£c JS ch√®n v√†o ƒë√¢y -->
            </main>
            <div class="pagination-controls" id="pagination-controls">
                <!-- N√∫t ph√¢n trang s·∫Ω ƒë∆∞·ª£c JS ch√®n v√†o ƒë√¢y -->
            </div>
            <div class="card-actions" style="justify-content: center; margin-top: 20px;">
                <button class="action-btn check-answer-btn" id="check-answers-btn">Ki·ªÉm tra ƒë√°p √°n</button>
            </div>
            <div id="result-message" class="feedback-message" style="text-align: center; margin-top: 20px;"></div>
        </div>
        <footer id="footer-placeholder"></footer>
    </div>

    <script src="js/data-listening-test.js"></script>
    <script src="js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const quizContainer = document.getElementById('quiz-container');
            const paginationControls = document.getElementById('pagination-controls');
            const checkAnswersBtn = document.getElementById('check-answers-btn');
            const resultMessage = document.getElementById('result-message');

            const questions = listeningData.part1;
            const questionsPerPage = 10;
            let currentPage = 1;

            function renderPage(page) {
                quizContainer.innerHTML = '';
                currentPage = page;
                const start = (page - 1) * questionsPerPage;
                const end = start + questionsPerPage;
                const questionsToRender = questions.slice(start, end);

                questionsToRender.forEach((q, index) => {
                    const questionIndex = start + index;
                    const questionElement = document.createElement('div');
                    questionElement.className = 'quiz-card listening-question';
                    questionElement.dataset.questionIndex = questionIndex;

                    let optionsHTML = '';
                    q.options.forEach((option, i) => {
                        optionsHTML += `
                            <label class="radio-label">
                                <input type="radio" name="question-${questionIndex}" value="${option}">
                                <span>${option}</span>
                            </label>
                        `;
                    });

                    // === PH·∫¶N ƒê√É C·∫¨P NH·∫¨T: Th√™m th·∫ª <audio> v√†o ƒë√¢y ===
                    questionElement.innerHTML = `
                        <p class="question-title">${questionIndex + 1}. ${q.question}</p>
                        <audio class="audio-player" controls src="${q.audioSrc}"></audio>
                        <div class="options-container">
                            ${optionsHTML}
                        </div>
                        <div class="feedback-answer" style="display: none;"></div>
                    `;
                    quizContainer.appendChild(questionElement);
                });
                renderPagination();
                resultMessage.textContent = '';
            }

            function renderPagination() {
                paginationControls.innerHTML = '';
                const pageCount = Math.ceil(questions.length / questionsPerPage);
                for (let i = 1; i <= pageCount; i++) {
                    const button = document.createElement('button');
                    button.textContent = i;
                    button.className = (i === currentPage) ? 'active' : '';
                    button.addEventListener('click', () => renderPage(i));
                    paginationControls.appendChild(button);
                }
            }

            checkAnswersBtn.addEventListener('click', function () {
                const questionCards = quizContainer.querySelectorAll('.listening-question');
                let correctCount = 0;

                questionCards.forEach(card => {
                    const questionIndex = parseInt(card.dataset.questionIndex);
                    const questionData = questions[questionIndex];
                    const selectedRadio = card.querySelector(`input[name="question-${questionIndex}"]:checked`);
                    const feedbackDiv = card.querySelector('.feedback-answer');

                    card.classList.remove('correct', 'incorrect');
                    feedbackDiv.style.display = 'block';

                    if (selectedRadio) {
                        if (selectedRadio.value === questionData.answer) {
                            card.classList.add('correct');
                            feedbackDiv.textContent = 'Ch√≠nh x√°c!';
                            correctCount++;
                        } else {
                            card.classList.add('incorrect');
                            feedbackDiv.innerHTML = `Sai r·ªìi! ƒê√°p √°n ƒë√∫ng l√†: <strong>${questionData.answer}</strong>`;
                        }
                    } else {
                        card.classList.add('incorrect');
                        feedbackDiv.innerHTML = `B·∫°n ch∆∞a ch·ªçn ƒë√°p √°n. ƒê√°p √°n ƒë√∫ng l√†: <strong>${questionData.answer}</strong>`;
                    }
                });

                resultMessage.innerHTML = `B·∫°n ƒë√£ tr·∫£ l·ªùi ƒë√∫ng <strong>${correctCount}/${questionCards.length}</strong> c√¢u tr√™n trang n√†y.`;
            });

            renderPage(1);
        });
    </script>
</body>

</html>