<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listening - Part 2 (C√¢u 15)</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;700&display=swap" rel="stylesheet">
<link rel="icon" href="img/favicon.png" type="image/x-icon">
</head>
<body>
    <header id="header-placeholder"></header>
    <div class="content-pusher">
        <div class="container">
            <div class="page-intro">
                <h1>Listening - Luy·ªán t·∫≠p C√¢u 15</h1>
                <p>Luy·ªán t·∫≠p ghi nh·ªõ key v√† quy lu·∫≠t ƒë·∫£o ng∆∞·ª£c</p>
            </div>
            <div class="explanation-box">
                <h3>üí° Quy lu·∫≠t v√†ng c·ªßa C√¢u 15</h3>
                <p>Nhi·ªám v·ª• l√† n·ªëi 4 √Ω ki·∫øn v·ªõi ng∆∞·ªùi n√≥i (Woman, Man, Both). ƒêi·ªÉm m·∫•u ch·ªët l√† th·ª© t·ª± n√≥i chuy·ªán:</p>
                <ul>
                    <li>N·∫øu <strong>Woman n√≥i tr∆∞·ªõc</strong>, key s·∫Ω l√† key g·ªëc (v√≠ d·ª•: W-B-M-B).</li>
                    <li>N·∫øu <strong>Man n√≥i tr∆∞·ªõc</strong>, key s·∫Ω b·ªã <strong>ƒë·∫£o ng∆∞·ª£c</strong>: W th√†nh M, M th√†nh W, c√≤n B gi·ªØ nguy√™n (v√≠ d·ª•: W-B-M-B ‚ûî M-B-W-B).</li>
                </ul>
                <p>H√£y s·ª≠ d·ª•ng c√¥ng t·∫Øc b√™n d∆∞·ªõi ƒë·ªÉ luy·ªán t·∫≠p quy lu·∫≠t n√†y cho t·ª´ng ch·ªß ƒë·ªÅ.</p>
            </div>

            <main id="listening-container" class="listening15-grid">
                <!-- C√°c ch·ªß ƒë·ªÅ s·∫Ω ƒë∆∞·ª£c ch√®n v√†o ƒë√¢y -->
            </main>
        </div>
        <footer id="footer-placeholder"></footer>
    </div>
    <script src="js/main.js"></script>
    <script src="js/data-listening.js"></script>
    <!-- Trong file listening_part15.html -->
        <!-- Trong file listening_part15.html -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const container = document.getElementById('listening-container');
            const topics = listeningData.part15;

            // H√†m t√≠nh to√°n key
            function calculateKey(baseKey, isManFirst, isFixed) {
                if (isManFirst && !isFixed) { // Ch·ªâ ƒë·∫£o ng∆∞·ª£c n·∫øu kh√¥ng ph·∫£i l√† key c·ªë ƒë·ªãnh
                    return baseKey.split('-').map(char => {
                        if (char === 'W') return 'M';
                        if (char === 'M') return 'W';
                        return 'B';
                    }).join('-');
                }
                return baseKey;
            }

            topics.forEach((topic) => {
                const card = document.createElement('div');
                card.className = 'quiz-card listening15-card';
                card.dataset.baseKey = topic.baseKey;
                // L∆∞u tr·∫°ng th√°i c·ªë ƒë·ªãnh v√†o dataset
                if (topic.isFixed) {
                    card.dataset.isFixed = "true";
                }

                // V√¥ hi·ªáu h√≥a c√¥ng t·∫Øc n·∫øu l√† tr∆∞·ªùng h·ª£p ngo·∫°i l·ªá
                const toggleDisabled = topic.isFixed ? 'disabled' : '';

                card.innerHTML = `
                    <div class="card-header">
                        <h2 class="listening15-title">${topic.title}</h2>
                        <div class="speaker-toggle-container ${toggleDisabled ? 'disabled' : ''}">
                            <span>Woman</span>
                            <label class="switch">
                                <input type="checkbox" class="speaker-toggle" ${toggleDisabled}>
                                <span class="slider round"></span>
                            </label>
                            <span>Man</span>
                        </div>
                    </div>
                    <p class="story-hint"><em>G·ª£i nh·ªõ: ${topic.story}</em></p>
                    <div class="card-actions">
                        <button class="action-btn show-listening15-key">Hi·ªán ƒë√°p √°n</button>
                    </div>
                    <div class="answer-section" style="display: none;">
                        <p class="final-key-display"></p>
                    </div>
                `;
                container.appendChild(card);
            });

            // --- LOGIC M·ªöI ---
            container.addEventListener('change', function(e) {
                if (e.target.classList.contains('speaker-toggle')) {
                    const card = e.target.closest('.listening15-card');
                    const answerSection = card.querySelector('.answer-section');
                    if (answerSection.style.display === 'block') {
                        const baseKey = card.dataset.baseKey;
                        const isManFirst = e.target.checked;
                        const isFixed = card.dataset.isFixed === "true";
                        const finalKey = calculateKey(baseKey, isManFirst, isFixed);
                        card.querySelector('.final-key-display').textContent = ` ${finalKey}`;
                    }
                }
            });

            container.addEventListener('click', function(e) {
                if (e.target.classList.contains('show-listening15-key')) {
                    const card = e.target.closest('.listening15-card');
                    const answerSection = card.querySelector('.answer-section');
                    const isVisible = answerSection.style.display === 'block';

                    if (!isVisible) {
                        const baseKey = card.dataset.baseKey;
                        const isManFirst = card.querySelector('.speaker-toggle').checked;
                        const isFixed = card.dataset.isFixed === "true";
                        const finalKey = calculateKey(baseKey, isManFirst, isFixed);
                        card.querySelector('.final-key-display').textContent = ` ${finalKey}`;
                    }

                    answerSection.style.display = isVisible ? 'none' : 'block';
                    e.target.textContent = isVisible ? '·∫®n ƒë√°p √°n' : 'Hi·ªán ƒë√°p √°n';
                }
            });
        });
    </script>
</body>
</html>