<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listening - Part 4 (Q16-17)</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/quiz.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="icon" href="img/favicon.png" type="image/x-icon">
</head>

<body>
    <header id="header-placeholder"></header>
    <div class="content-pusher">
        <div class="container">
            <div class="page-intro">
                <h1>Listening - Part 4 (C√¢u 16-17)</h1>
                <p>Nghe m·ªôt ƒëo·∫°n ƒë·ªôc tho·∫°i d√†i h∆°n v√† tr·∫£ l·ªùi 2 c√¢u h·ªèi v·ªÅ n√≥.</p>
            </div>
            <div class="explanation-box">
                <h3>üí° Ph∆∞∆°ng ph√°p ki·ªÉm tra tr√≠ nh·ªõ</h3>
                <p>
                    ƒê√¢y l√† trang ki·ªÉm tra nhanh tr√≠ nh·ªõ c·ªßa b·∫°n. M·ª•c ti√™u l√† <b>v·∫≠n d·ª•ng</b> nh·ªØng g√¨ b·∫°n ƒë√£ h·ªçc ƒë∆∞·ª£c t·ª´
                    trang "List Key" ƒë·ªÉ tr·∫£ l·ªùi c√°c c√¢u h·ªèi.
                </p>
                <p>
                    N·∫øu b·∫°n ch∆∞a √¥n t·∫≠p, h√£y m·ªü trang n√†y ƒë·ªÉ √¥n nh√©!
                </p>

                <div class="resource-links">
                    <a href="listening_part1617.html" target="_blank" class="action-btn">H·ªçc t·ª´ trang List Key</a>
                </div>

                <h4>C√°c b∆∞·ªõc th·ª±c hi·ªán:</h4>
                <ol>
                    <li><strong>√în t·∫≠p th·∫≠t k·ªπ:</strong> D√†nh th·ªùi gian h·ªçc thu·ªôc c√°c ƒë√°p √°n v√† ghi nh·ªõ t·ª´ in ƒë·∫≠m.</li>
                    <li><strong>Ki·ªÉm tra tr√≠ nh·ªõ:</strong> Quay l·∫°i trang n√†y v√† tr·∫£ l·ªùi t·∫•t c·∫£ c√°c c√¢u h·ªèi d·ª±a tr√™n
                        nh·ªØng g√¨ b·∫°n nh·ªõ ƒë∆∞·ª£c.</li>
                    <li><strong>Xem k·∫øt qu·∫£:</strong> Sau khi ho√†n th√†nh, nh·∫•n n√∫t "Ki·ªÉm tra ƒë√°p √°n" ·ªü cu·ªëi trang ƒë·ªÉ xem
                        b·∫°n ƒë√£ nh·ªõ ƒë√∫ng bao nhi√™u c√¢u.</li>
                </ol>
            </div>
            <main id="quiz-container">
                <!-- N·ªôi dung c√¢u h·ªèi tr·∫Øc nghi·ªám s·∫Ω ƒë∆∞·ª£c JS ch√®n v√†o ƒë√¢y -->
            </main>
            <div class="pagination-controls" id="pagination-controls">
                <!-- N√∫t ph√¢n trang s·∫Ω ƒë∆∞·ª£c JS ch√®n v√†o ƒë√¢y -->
            </div>
            <div class="card-actions" style="justify-content: center; margin-top: 20px;">
                <button class="action-btn check-answer-btn" id="check-answers-btn">Ki·ªÉm tra ƒë√°p √°n</button>
            </div>
            <div id="result-message" class="feedback-message" style="text-align: center; margin-top: 20px;"></div>
        </div>
        <footer id="footer-placeholder"></footer>
    </div>

    <script src="js/data-listening-part4.js"></script>
    <script src="js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const quizContainer = document.getElementById('quiz-container');
            const paginationControls = document.getElementById('pagination-controls');
            const checkAnswersBtn = document.getElementById('check-answers-btn');
            const resultMessage = document.getElementById('result-message');

            const questions = listeningPart4Data.part4;
            const questionsPerPage = 10;
            let currentPage = 1;

            // === H√ÄM RENDER ƒê√É ƒê∆Ø·ª¢C C·∫¨P NH·∫¨T LOGIC ƒê√ÅNH S·ªê ===
            function renderPage(page) {
                quizContainer.innerHTML = '';
                currentPage = page;
                const start = (page - 1) * questionsPerPage;
                const end = start + questionsPerPage;
                const questionsToRender = questions.slice(start, end);

                let topicCounter = Math.floor(start / 2) + 1;
                let subQuestionCounter = 1;

                questionsToRender.forEach((q, index) => {
                    const questionIndex = start + index;

                    // Logic ƒë√°nh s·ªë m·ªõi
                    if (index > 0 && q.topicId !== questionsToRender[index - 1].topicId) {
                        topicCounter++;
                        subQuestionCounter = 1;
                    }
                    const questionNumber = `${topicCounter}.${subQuestionCounter}`;
                    subQuestionCounter++;

                    const questionElement = document.createElement('div');
                    questionElement.className = 'quiz-card listening-question';
                    questionElement.dataset.questionIndex = questionIndex;

                    let optionsHTML = '';
                    q.options.forEach((option) => {
                        optionsHTML += `
                            <label class="radio-label">
                                <input type="radio" name="question-${questionIndex}" value="${option}">
                                <span>${option}</span>
                            </label>
                        `;
                    });

                    questionElement.innerHTML = `
                        <p class="question-title">${questionNumber}. ${q.question}</p>
                        <div class="options-container">
                            ${optionsHTML}
                        </div>
                        <div class="feedback-answer" style="display: none;"></div>
                    `;
                    quizContainer.appendChild(questionElement);
                });
                renderPagination();
                resultMessage.textContent = '';
            }

            function renderPagination() {
                paginationControls.innerHTML = '';
                const pageCount = Math.ceil(questions.length / questionsPerPage);
                for (let i = 1; i <= pageCount; i++) {
                    const button = document.createElement('button');
                    button.textContent = i;
                    button.className = (i === currentPage) ? 'active' : '';
                    button.addEventListener('click', () => renderPage(i));
                    paginationControls.appendChild(button);
                }
            }

            checkAnswersBtn.addEventListener('click', function () {
                const questionCards = quizContainer.querySelectorAll('.listening-question');
                let correctCount = 0;

                questionCards.forEach(card => {
                    const questionIndex = parseInt(card.dataset.questionIndex);
                    const questionData = questions[questionIndex];
                    const selectedRadio = card.querySelector(`input[name="question-${questionIndex}"]:checked`);
                    const feedbackDiv = card.querySelector('.feedback-answer');

                    card.classList.remove('correct', 'incorrect');
                    feedbackDiv.style.display = 'block';

                    if (selectedRadio) {
                        if (selectedRadio.value === questionData.answer) {
                            card.classList.add('correct');
                            feedbackDiv.textContent = 'Ch√≠nh x√°c!';
                            correctCount++;
                        } else {
                            card.classList.add('incorrect');
                            feedbackDiv.innerHTML = `Sai r·ªìi! ƒê√°p √°n ƒë√∫ng l√†: <strong>${questionData.answer}</strong>`;
                        }
                    } else {
                        card.classList.add('incorrect');
                        feedbackDiv.innerHTML = `B·∫°n ch∆∞a ch·ªçn ƒë√°p √°n. ƒê√°p √°n ƒë√∫ng l√†: <strong>${questionData.answer}</strong>`;
                    }
                });

                resultMessage.innerHTML = `B·∫°n ƒë√£ tr·∫£ l·ªùi ƒë√∫ng <strong>${correctCount}/${questionCards.length}</strong> c√¢u tr√™n trang n√†y.`;
            });

            renderPage(1);
        });
    </script>
</body>

</html>